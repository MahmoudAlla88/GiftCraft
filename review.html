<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review and Rating</title>
    <style>
        .stars {
          display: flex;
          flex-direction: row-reverse;
          justify-content: flex-end;
          cursor: pointer;
        }
        .star {
          font-size: 36px;
          color: #e9e4e4;
          margin: 0 5px;
        }
        .star.selected {
          color: gold;
        }
      </style>
</head>

<body>
    <h1>Review and Rating System</h1>

    <!-- Form to add a comment -->
    <form id="reviewForm">
        <label for="userName">Name:</label>
        <input type="text" id="userName" required><br><br>

        <label for="comment">Comment:</label>
        <input type="text" id="comment" required><br><br>

        <label>Rating:</label>
        <div id="ratingStars" class="stars">
          <span class="star" data-value="5">★</span>
          <span class="star" data-value="4">★</span>
          <span class="star" data-value="3">★</span>
          <span class="star" data-value="2">★</span>
          <span class="star" data-value="1">★</span>
        </div><br>

        <button type="submit">Submit</button>
    </form>

    <!-- Container to display reviews -->
    <h2>All Reviews</h2>
    <div id="reviewsContainer"></div>

    <script type="module">
        // Initialize Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
        import {
            getFirestore,
            addDoc,
            collection,
            getDocs,
            deleteDoc,
            doc,
            getDoc,
            updateDoc

        } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyADpIPsj1xK_9L7t8XMFB_CGQN0RBzqDiM",
            authDomain: "gift-shop-779d5.firebaseapp.com",
            projectId: "gift-shop-779d5",
            storageBucket: "gift-shop-779d5.firebasestorage.app",
            messagingSenderId: "1046929050162",
            appId: "1:1046929050162:web:48582f43a2a466c7c78a2b"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        console.log(db);

        let selectedRating = 0;

    // Handle star click for rating
    const stars = document.querySelectorAll(".star");
    stars.forEach(star => {
      star.addEventListener("click", () => {
        selectedRating = parseInt(star.getAttribute("data-value"));
        updateStarColors(selectedRating);
      });
    });

    function updateStarColors(rating) {
      stars.forEach(star => {
        const starValue = parseInt(star.getAttribute("data-value"));
        if (starValue <= rating) {
          star.classList.add("selected");
        } else {
          star.classList.remove("selected");
        }
      });
    }


        async function addData(e) {
            e.preventDefault();
            const userName = document.getElementById('userName').value;
            const comment = document.getElementById('comment').value;
            const timeComment = `${new Date().getFullYear()}-${new Date().getMonth() + 1}-${new Date().getDate()} at:  ${new Date().getHours()}:${new Date().getMinutes()}`;
            
            
            try {
                const docRef = await addDoc(collection(db, "ratingProduct"), {
                    userName:userName,
                    comment: comment,
                    rating :selectedRating,
                    times : timeComment
                })


            alert('Review added!'); 
            fetchReviews();

            }
            catch (error) {
                console.log(error)
            }
        }

        document.getElementById('reviewForm').addEventListener('submit', addData);

        // Fetch and display reviews
        async function fetchReviews() {
            const reviewsContainer = document.getElementById('reviewsContainer');
            reviewsContainer.innerHTML = ''; // Clear previous reviews

            const querySnapshot = await getDocs(collection(db, "ratingProduct"));
            querySnapshot.forEach(doc => {
                const review = doc.data();
                const reviewDiv = document.createElement('div');
                reviewDiv.innerHTML = `
          <p><strong>Name:</strong> ${review.userName}</p>
          <p><strong>Comment:</strong> ${review.comment}</p>
          <p><strong>Rating:</strong> ${'⭐'.repeat(review.rating)}</p>
          <p><strong>Date:</strong> ${review.times}</p>
          <hr>
        `;
                reviewsContainer.appendChild(reviewDiv);
            });
        }

        
        fetchReviews();
    </script>
</body>

</html>